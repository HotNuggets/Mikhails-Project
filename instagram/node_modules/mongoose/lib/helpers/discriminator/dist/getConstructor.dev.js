'use strict';

var getDiscriminatorByValue = require('./getDiscriminatorByValue');
/**
 * Find the correct constructor, taking into account discriminators
 * @api private
 */


module.exports = function getConstructor(Constructor, value, defaultDiscriminatorValue) {
  var discriminatorKey = Constructor.schema.options.discriminatorKey;
  var discriminatorValue = value != null && value[discriminatorKey];

  if (discriminatorValue == null) {
    discriminatorValue = defaultDiscriminatorValue;
  }

  if (Constructor.discriminators && discriminatorValue != null) {
    if (Constructor.discriminators[discriminatorValue]) {
      Constructor = Constructor.discriminators[discriminatorValue];
    } else {
      var constructorByValue = getDiscriminatorByValue(Constructor.discriminators, discriminatorValue);

      if (constructorByValue) {
        Constructor = constructorByValue;
      }
    }
  }

  return Constructor;
};
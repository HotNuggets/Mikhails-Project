'use strict';

module.exports = function setDocumentTimestamps(doc, timestampOption, currentTime, createdAt, updatedAt) {
  var skipUpdatedAt = timestampOption != null && timestampOption.updatedAt === false;
  var skipCreatedAt = timestampOption != null && timestampOption.createdAt === false;
  var defaultTimestamp = currentTime != null ? currentTime() : doc.ownerDocument().constructor.base.now();

  if (!skipCreatedAt && (doc.isNew || doc.$isSubdocument) && createdAt && !doc.$__getValue(createdAt) && doc.$__isSelected(createdAt)) {
    doc.$set(createdAt, defaultTimestamp, undefined, {
      overwriteImmutable: true
    });
  }

  if (!skipUpdatedAt && updatedAt && (doc.isNew || doc.$isModified())) {
    var ts = defaultTimestamp;

    if (doc.isNew && createdAt != null) {
      ts = doc.$__getValue(createdAt);
    }

    doc.$set(updatedAt, ts);
  }
};